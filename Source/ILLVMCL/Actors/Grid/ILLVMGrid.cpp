// Fill out your copyright notice in the Description page of Project Settings.


#include "Actors/Grid/ILLVMGrid.h"
#include "Simulation/ILLMVSimulationSubsystem.h"
#include "Engine/World.h"

//////////////////////////////////////////////////////////////////////////
///
//////////////////////////////////////////////////////////////////////////

AILLVMGrid::AILLVMGrid(const FObjectInitializer& ObjectInitializer) :
	Super(ObjectInitializer)
{
	// Not need of ticking
	PrimaryActorTick.bCanEverTick = false;
	PrimaryActorTick.bStartWithTickEnabled = false;

}

//////////////////////////////////////////////////////////////////////////
///
//////////////////////////////////////////////////////////////////////////

void AILLVMGrid::OnConstruction(const FTransform& Transform)
{
	Super::OnConstruction(Transform);
	GenerateGrid();
}

//////////////////////////////////////////////////////////////////////////
///
//////////////////////////////////////////////////////////////////////////

FVector2D AILLVMGrid::GetGridRandomLocation() const
{
	return FVector2D(FMath::RandRange(0, Columns - 1), FMath::RandRange(0, Rows - 1));
}

//////////////////////////////////////////////////////////////////////////
///
//////////////////////////////////////////////////////////////////////////

const FVector& AILLVMGrid::GetGridWorldLocation(const FVector2D& GridLocation) const
{
	return GetGrid()[GridLocation.X].TilesRow[GridLocation.Y].WorldLocation;
}

//////////////////////////////////////////////////////////////////////////
///
//////////////////////////////////////////////////////////////////////////

void AILLVMGrid::BeginPlay()
{
	Super::BeginPlay();
	UILLMVSimulationSubsystem* simulationSubsystem = GetWorld()->GetSubsystem<UILLMVSimulationSubsystem>();
	if (simulationSubsystem != nullptr)
	{
		simulationSubsystem->InitializeSimulation(this);
	}
}